
&НаСервере
Процедура ИзменитьСписокЗадач()
	наборЗаписей = РегистрыСведений.ЗадачиКВыполнению.СоздатьНаборЗаписей();
	наборЗаписей.Прочитать();
	
	нумерация = 1;
	
	Для каждого некаяЗапись Из наборЗаписей Цикл
		Если НЕ (некаяЗапись.Статус = Перечисления.Статус.Закрыт
			ИЛИ некаяЗапись.Статус = Перечисления.Статус.Решен) Тогда
			некаязапись.СистемныйПриоритет = нумерация;
			
			нумерация = нумерация + 1;
		КонецЕсли;
	КонецЦикла;
	
	наборЗаписей.Записать();
КонецПроцедуры // ИзменитьСписокЗадач()

&НаСервере
Процедура ВосстановитьПорядок()
	новыйПорядок = Новый Соответствие;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	ЗадачиКВыполнению.Дело,
	|	ЗадачиКВыполнению.Статус,
	|	ЗадачиКВыполнению.СистемныйПриоритет
	|ИЗ
	|	РегистрСведений.ЗадачиКВыполнению КАК ЗадачиКВыполнению
	|ГДЕ
	|	НЕ (ЗадачиКВыполнению.Статус = Значение(Перечисление.Статус.Закрыт) 
	|		ИЛИ ЗадачиКВыполнению.Статус = Значение(Перечисление.Статус.Решен) 
	|		ИЛИ ЗадачиКВыполнению.Статус = Значение(Перечисление.Статус.Уточняется) 
	|		ИЛИ ЗадачиКВыполнению.СистемныйПриоритет = 0
	|		)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ЗадачиКВыполнению.СистемныйПриоритет
	|";
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	нумерация = 1;
	
	Пока Выборка.Следующий() Цикл
		Если НЕ (Выборка.Статус = Перечисления.Статус.Закрыт
			ИЛИ Выборка.Статус = Перечисления.Статус.Решен) Тогда
			
			новыйПорядок.Вставить(Выборка.Дело, нумерация);
			
			нумерация = нумерация + 1;
		КонецЕсли;
	КонецЦикла;
	
	Если новыйПорядок.Количество() > 0 Тогда
		наборЗаписей = РегистрыСведений.ЗадачиКВыполнению.СоздатьНаборЗаписей();
		наборЗаписей.Прочитать();
	
		Для каждого записьРегистра Из наборЗаписей Цикл
			Если записьРегистра.Статус = Перечисления.Статус.Закрыт
				ИЛИ записьРегистра.Статус = Перечисления.Статус.Решен Тогда
				Продолжить;
			КонецЕсли;
			новоеЗнач = новыйПорядок[записьРегистра.Дело];
			Если НЕ новоеЗнач = Неопределено Тогда
				записьРегистра.СистемныйПриоритет = новоеЗнач;
			КонецЕсли;
		КонецЦикла;
	
	 	наборЗаписей.Записать();
	КонецЕсли;
КонецПроцедуры // ВосстановитьПорядок()

&НаСервере
Процедура удалитьВсеИзДел()
	ИмяРегистра = "Дела";
	наборЗаписей = РегистрыСведений[ИмяРегистра].СоздатьНаборЗаписей();
	наборЗаписей.Прочитать();
	наборЗаписей.Очистить();
	наборЗаписей.Записать();
КонецПроцедуры // удалитьВсеИзДел()

&НаКлиенте
Процедура ЗаполнитьПорядокДляЗакрытыхЗадач(Команда)
	//ИзменитьСписокЗадач();
	ВосстановитьПорядок();
	//удалитьВсеИзДел();
КонецПроцедуры
